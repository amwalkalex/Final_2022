---
title: "Covid91 vaccine study Final2023"
author: "Amber Walker!"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
males = filter(FinalData, sex =="M")
females = filter(FinalData, sex =="F")
LGBTQ = filter(FinalData, LGBTQ =="gay")
Druggies = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

#methods

The variables from FinalData needed to be changed from character variables into factor variables. Specific subgroups had to be separated from the broader categories in order to properly studied. Female, male, Druggies, and LGBTQ were all separated into subgroups. All of these categories are isolated to see weather or not these particular populations got sick and who did not from taking the placebo.

## Males

```{r}
dd2 <- males %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```
There are two different plots based on males and their results of getting infected or not based on them taking the placebo or vaccine. The first plot will show side-by-side bars where the height of each bar represents the count of observations for each combination of infected and treatment. The second plot will show side-by-side bars where the height of each bar represents the percentage of observations for each combination of infected and treatment.It seems as though roughly about the same amount of people were given the placebo and given the vaccine. However, many more people were non-oinfectes as suppose to the much smaller amount of people that was. 

### Numerical results

```{r}
table1 <- xtabs(~infected + treatment, data=males)
rowPerc(table1)
colPerc(table1)
```

These numerical results show specific percentages of males that got covid-19 after taking the placebo and taking the vaccine. 2.55 males were given the placebo and were infected, and 97.45 were not infected. This shows that many more people who were given the placebo were not infected as supposed to those who were infected. As far as the males that were given the vaccine, 1.15 were infected and 98.85 were not infected. This shows that there was a large number of males that were not infected after receiving the vaccine as supposed to those who did not. Based on this it seems that it was a much larger amount of males not being infected whether they took the vaccine or not. 

### Inferential 


```{r}
chisq.test(table1)
chisqtestGC(table1)
guysfish <- fisher.test(table1)
guysfish
```
Based on the results, both Pearson's Chi-squared test and Fisher's Exact Test indicate a significant association between the infected and treatment variables. The odds ratio indicates that the odds of being infected with covid19 are higher for individuals receiving the vaccine treatment compared to the placebo treatment, and this difference is statistically significant.

```{r}
effect <- guysfish$p.value/(guysfish$p.value +1)
effectivenessguy = guysfish$estimate/(guysfish$estimate +1)*100
print(effectivenessguy)
```

```{r}
low=(guysfish$conf.int[1]/(guysfish$conf.int[1] +1))*100
hi=(guysfish$conf.int[2]/(guysfish$conf.int[2] +1))*100
options(digits=2)
```


Above is the effectiveness for the covid-19 vaccine for males. Based on the interval seen above,the odds ratio for the  males are 69. The odds ratio is approximately how effective the vaccine is. We can conclude that the vaccine is effective in protecting guys from getting covid-19. 


## Females

## LGBTQ

## Druggies

# Overall Results and Conclusions
